<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        <title>Station Monitor</title>
        <link rel="stylesheet" href="./style.css" />
    </head>
    <body>
        <main>
            <h1>Station Monitor</h1>
            <p>Loading...</p>
        </main>
        <script>
            const updateStatus = () => {
                fetch("/status")
                    .then((response) => response.json())
                    .then((data) => {
                        // Update the page with the new data
                        let dataHtml = `<h1>Station Monitor ${data.rpiTime}</h1>`;
                        //dataHtml += `<h2>Station Time: ${data.rpiTime}</h2>`;
                        dataHtml += `<h2 style="margin-bottom: .5%">Distance Sensors:</h2>`;
                        dataHtml += `<ul style="margin-top: 0px">`;
                        Object.keys(data["distanceSensors"]).forEach(
                            (sensor) => {
                                let sensorData = `<li><p style="margin-top: 0px">${sensor}: <br/>`;
                                sensorData += `&nbsp&nbsp&nbsp&nbsp&nbsp&nbspStable Distance: ${data["distanceSensors"][sensor]["stableDistance"]} mm <br/>`;
                                sensorData += `&nbsp&nbsp&nbsp&nbsp&nbsp&nbspOccupied Distance: ${data["distanceSensors"][sensor]["occupiedDistance"]} mm <br/>`;
                                sensorData += `&nbsp&nbsp&nbsp&nbsp&nbsp&nbspIs Occupied: ${data["distanceSensors"][sensor]["isOccupied"]} <br/>`;
                                sensorData += `&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDuration: ${data["distanceSensors"][sensor]["duration"]} <br/>`;
                                sensorData += `&nbsp&nbsp&nbsp&nbsp&nbsp&nbspRaw Distance: ${data["distanceSensors"][sensor]["currentDistance"]} mm <br/>`;
                                sensorData += `&nbsp&nbsp&nbsp&nbsp&nbsp&nbspReflection Strength: ${data["distanceSensors"][sensor]["reflectionStrength"]}%<br/>`;
                                sensorData += `&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSensor Temp (C): ${data["distanceSensors"][sensor]["temperature"]}<br/>`;
                                sensorData += "</p></li>";
                                dataHtml += sensorData;
                            }
                        );
                        dataHtml += "</ul>";
                        dataHtml += `<h2 style="margin-bottom: .5%">Long Distance Sensors:</h2>`;
                        dataHtml += `<ul style="margin-top: 0px">`;
                        Object.keys(data["longDistanceSensors"]).forEach(
                            (sensor) => {
                                let sensorData = `<li><p style="margin-top: 0px">${sensor}: <br/>`;
                                sensorData += `&nbsp&nbsp&nbsp&nbsp&nbsp&nbspStable Distance: ${data["longDistanceSensors"][sensor]["stableDistance"]} mm <br/>`;
                                sensorData += `&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSensor Readings: ${data["longDistanceSensors"][sensor]["readingCount"]} mm <br/>`;
                                sensorData += `&nbsp&nbsp&nbsp&nbsp&nbsp&nbspOccupied Distance: ${data["longDistanceSensors"][sensor]["occupiedDistance"]} mm <br/>`;
                                sensorData += `&nbsp&nbsp&nbsp&nbsp&nbsp&nbspIs Occupied: ${data["longDistanceSensors"][sensor]["isOccupied"]} <br/>`;
                                sensorData += `&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDuration: ${data["longDistanceSensors"][sensor]["duration"]} <br/>`;
                                sensorData += `&nbsp&nbsp&nbsp&nbsp&nbsp&nbspRaw Distance: ${data["longDistanceSensors"][sensor]["currentDistance"]} mm <br/>`;
                                sensorData += `&nbsp&nbsp&nbsp&nbsp&nbsp&nbspReflection Strength: ${data["longDistanceSensors"][sensor]["reflectionStrength"]}%<br/>`;
                                sensorData += `&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSensor Temp (C): ${data["longDistanceSensors"][sensor]["temperature"]}<br/>`;
                                sensorData += "</p></li>";
                                dataHtml += sensorData;
                            }
                        );
                        dataHtml += "</ul>";
                        dataHtml += "<h2>Reflective Sensors:</h2>";
                        Object.keys(data["reflectiveSensors"]).forEach(
                            (sensor) => {
                                let sensorData = `<li><p style="margin-top: 0px">${sensor}: <br/>`;
                                sensorData += `&nbsp&nbsp&nbsp&nbsp&nbsp&nbspIs Occupied: ${data["reflectiveSensors"][sensor]["isOccupied"]} <br/>`;
                                sensorData += `&nbsp&nbsp&nbsp&nbsp&nbsp&nbspEvent State: ${data["reflectiveSensors"][sensor]["eventState"]} <br/>`;
                                sensorData += `&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDuration: ${data["reflectiveSensors"][sensor]["duration"]} <br/>`;
                                sensorData += "</p></li>";
                                dataHtml += sensorData;
                            }
                        );
                        document.querySelector("main").innerHTML = dataHtml;
                    })
                    .catch((error) =>
                        console.error("Error fetching data:", error)
                    );
            };
            updateStatus(); // Initial call to fetch data

            // Generate code to refresh the page every 5 seconds
            setInterval(updateStatus, 250);
        </script>
    </body>
</html>
